var fs = require('fs');
var logger = require('../funciones/utilerias/logger');
var config_valida = require('../configuraciones/config_validacion.json');
var esquema = require('../funciones/validaciones/esquema');
var { HTTP_CODIGOS } = require('../configuraciones/codigos_http');
<% if (micro_conexion == 'psql' || micro_conexion == 'ambas') { _%>
// var consulta_psql = require('../funciones/consulta/consulta_psql');
<% } _%>
<% if (micro_conexion == 'mssql' || micro_conexion == 'ambas') { _%>
// var consulta_mssql = require('../funciones/consulta/consulta_mssql');
<% } _%>

exports.consultar = async (req, res) => {
    let parametros = {
        'query': req.query,
        'path': req.params,
        'body': req.body,
        'headers': req.headers
    };

    logger.debug('Parametros:' + JSON.stringify(parametros));
    let respuesta_json = JSON.parse(fs.readFileSync('configuraciones/respuesta.json') );

    try {
        <%= micro_metodo == 'get' ? '// ' : '' _%>config_valida.SimpleHeader.body.requerido = true;
        let respuesta_validacion = await esquema.validar_parametros(req, config_valida.SimpleHeader);
        if (respuesta_validacion.detalle) {
            respuesta_json.codigo = respuesta_validacion.codigo;
            respuesta_json.errores = respuesta_validacion.detalle.error;
            respuesta_json.mensaje = respuesta_validacion.mensaje;
            return res.status(HTTP_CODIGOS._400.estatus).send(respuesta_json);
        }

        res.status(HTTP_CODIGOS._200.estatus).send(respuesta_json);
    } catch (err) {
        logger.error('Error en b√∫squeda: ' + err);
        respuesta_json.codigo = HTTP_CODIGOS._500.contexto._101.codigo;
        respuesta_json.mensaje = HTTP_CODIGOS._500.contexto._101.mensaje;
        respuesta_json.errores.push(err.message);
        res.status(HTTP_CODIGOS._500.estatus).send(respuesta_json);
        return;
    }
}